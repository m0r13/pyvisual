{
    "connections": [
        {
            "dst_node_id": 11,
            "dst_port_id": "i_input",
            "src_node_id": 2,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 3,
            "dst_port_id": "i_sizeref",
            "src_node_id": 2,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 4,
            "dst_port_id": "i_input",
            "src_node_id": 3,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 4,
            "dst_port_id": "i_uRadiusFactor",
            "src_node_id": 5,
            "src_port_id": "o_vec2"
        },
        {
            "dst_node_id": 9,
            "dst_port_id": "i_input",
            "src_node_id": 8,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 0,
            "dst_port_id": "i_texture",
            "src_node_id": 9,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 9,
            "dst_port_id": "i_uRedOffset",
            "src_node_id": 10,
            "src_port_id": "o_vec2"
        },
        {
            "dst_node_id": 11,
            "dst_port_id": "i_time",
            "src_node_id": 1,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 14,
            "dst_port_id": "i_input",
            "src_node_id": 6,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 8,
            "dst_port_id": "i_input",
            "src_node_id": 11,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 11,
            "dst_port_id": "i_mouse",
            "src_node_id": 12,
            "src_port_id": "o_vec2"
        },
        {
            "dst_node_id": 12,
            "dst_port_id": "i_x",
            "src_node_id": 13,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 11,
            "dst_port_id": "i_time_mask",
            "src_node_id": 14,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 17,
            "dst_port_id": "i_t1",
            "src_node_id": 15,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 17,
            "dst_port_id": "i_t2",
            "src_node_id": 16,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 14,
            "dst_port_id": "i_transformUV",
            "src_node_id": 17,
            "src_port_id": "o_output"
        },
        {
            "dst_node_id": 16,
            "dst_port_id": "i_theta",
            "src_node_id": 18,
            "src_port_id": "o_output"
        }
    ],
    "nodes": [
        {
            "custom_ports": [],
            "id": 0,
            "manual_values": {
                "i_texture": ""
            },
            "type": "Renderer",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2907.0,
                    277.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 1,
            "manual_values": {
                "i_factor": 0.47999998927116394,
                "i_mod": 0.0,
                "i_reset": 0.0,
                "o_output": 1.9834812483903477
            },
            "type": "Time",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1538.0,
                    373.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 2,
            "manual_values": {
                "i_path": "image/test/gradient.png",
                "o_output": ""
            },
            "type": "LoadTexture",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1368.0,
                    189.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 3,
            "manual_values": {
                "i_enabled": 1.0,
                "i_force_change": 42.0,
                "i_input": "",
                "i_interpolation": 1.0,
                "i_sizeref": "",
                "i_transformUV": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "i_uColor": [
                    1.0,
                    0.9999899864196777,
                    0.9999899864196777,
                    1.0
                ],
                "i_wrapping": 1.0,
                "o_enabled": 1.0,
                "o_output": ""
            },
            "type": "Fill",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1460.0,
                    -232.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [
                [
                    "i_filter_mask",
                    {
                        "default": null,
                        "dtype": "tex2d",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mask",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_mode",
                    {
                        "default": null,
                        "dtype": "int",
                        "dtype_args": {
                            "choices": [
                                "input",
                                "mask",
                                "filtered",
                                "input_filtered_masked",
                                "input_masked",
                                "filtered_masked"
                            ],
                            "default": 2.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mode",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_bg",
                    {
                        "default": null,
                        "dtype": "color",
                        "dtype_args": {
                            "default": [
                                0.0,
                                0.0,
                                0.0,
                                0.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_bg",
                        "widgets": []
                    }
                ],
                [
                    "i_uRadius",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 1.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uRadius",
                        "widgets": []
                    }
                ],
                [
                    "i_uRadiusFactor",
                    {
                        "default": null,
                        "dtype": "vec2",
                        "dtype_args": {
                            "default": [
                                1.0,
                                1.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uRadiusFactor",
                        "widgets": []
                    }
                ],
                [
                    "i_uDistanceOrder",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 2.0,
                            "range": [
                                0.0,
                                Infinity
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uDistanceOrder",
                        "widgets": []
                    }
                ],
                [
                    "i_uSoftness",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 0.35,
                            "range": [
                                0.0,
                                Infinity
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uSoftness",
                        "widgets": []
                    }
                ],
                [
                    "i_uIntensity",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 0.5,
                            "range": [
                                0.0,
                                1.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uIntensity",
                        "widgets": []
                    }
                ]
            ],
            "id": 4,
            "manual_values": {
                "i_advanced_filtering": 0.0,
                "i_enabled": 1.0,
                "i_filter_bg": [
                    0.0,
                    0.0,
                    0.0,
                    0.0
                ],
                "i_filter_mask": "",
                "i_filter_mode": 2.0,
                "i_force_change": 42.0,
                "i_input": "",
                "i_interpolation": 1.0,
                "i_sizeref": "",
                "i_transformUV": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "i_uDistanceOrder": 2.0,
                "i_uIntensity": 1.0,
                "i_uRadius": 3.2899999618530273,
                "i_uRadiusFactor": [
                    1.0,
                    1.0
                ],
                "i_uSoftness": 2.5,
                "i_wrapping": 1.0,
                "o_enabled": 1.0,
                "o_output": ""
            },
            "type": "Vignette",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1724.0,
                    -177.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 5,
            "manual_values": {
                "i_x": 1.590000033378601,
                "i_y": 1.0,
                "o_vec2": [
                    1.590000033378601,
                    1.0
                ]
            },
            "type": "Float2Vec2",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1510.0,
                    -7.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 6,
            "manual_values": {
                "i_path": "image/test/gradient.png",
                "o_output": ""
            },
            "type": "LoadTexture",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1604.0,
                    87.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 7,
            "manual_values": {
                "i_off_max": 3.5899999141693115,
                "i_off_min": 0.1,
                "i_off_scale": 0.5,
                "i_on_max": 0.20000000298023224,
                "i_on_min": 0.05000000074505806,
                "i_on_scale": 0.8600000143051147,
                "o_output": 0.0
            },
            "type": "GlitchTimer",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2116.0,
                    -73.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [
                [
                    "i_filter_mask",
                    {
                        "default": null,
                        "dtype": "tex2d",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mask",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_mode",
                    {
                        "default": null,
                        "dtype": "int",
                        "dtype_args": {
                            "choices": [
                                "input",
                                "mask",
                                "filtered",
                                "input_filtered_masked",
                                "input_masked",
                                "filtered_masked"
                            ],
                            "default": 2.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mode",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_bg",
                    {
                        "default": null,
                        "dtype": "color",
                        "dtype_args": {
                            "default": [
                                0.0,
                                0.0,
                                0.0,
                                0.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_bg",
                        "widgets": []
                    }
                ],
                [
                    "i_uHue",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 0.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uHue",
                        "widgets": []
                    }
                ],
                [
                    "i_uSaturation",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 1.0,
                            "range": [
                                0.0,
                                Infinity
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uSaturation",
                        "widgets": []
                    }
                ],
                [
                    "i_uValue",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 1.0,
                            "range": [
                                0.0,
                                Infinity
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uValue",
                        "widgets": []
                    }
                ]
            ],
            "id": 8,
            "manual_values": {
                "i_advanced_filtering": 0.0,
                "i_enabled": 0.0,
                "i_force_change": 42.0,
                "i_input": "",
                "i_sizeref": "",
                "i_uHue": 0.0,
                "i_uSaturation": 0.0,
                "i_uValue": 1.0,
                "o_enabled": 0.0,
                "o_output": ""
            },
            "type": "HSVAdjust",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2327.0,
                    224.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [
                [
                    "i_filter_mask",
                    {
                        "default": null,
                        "dtype": "tex2d",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mask",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_mode",
                    {
                        "default": null,
                        "dtype": "int",
                        "dtype_args": {
                            "choices": [
                                "input",
                                "mask",
                                "filtered",
                                "input_filtered_masked",
                                "input_masked",
                                "filtered_masked"
                            ],
                            "default": 2.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mode",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_bg",
                    {
                        "default": null,
                        "dtype": "color",
                        "dtype_args": {
                            "default": [
                                0.0,
                                0.0,
                                0.0,
                                0.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_bg",
                        "widgets": []
                    }
                ],
                [
                    "i_uRedOffset",
                    {
                        "default": null,
                        "dtype": "vec2",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uRedOffset",
                        "widgets": []
                    }
                ],
                [
                    "i_uGreenOffset",
                    {
                        "default": null,
                        "dtype": "vec2",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uGreenOffset",
                        "widgets": []
                    }
                ],
                [
                    "i_uBlueOffset",
                    {
                        "default": null,
                        "dtype": "vec2",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "uBlueOffset",
                        "widgets": []
                    }
                ]
            ],
            "id": 9,
            "manual_values": {
                "i_advanced_filtering": 0.0,
                "i_enabled": 0.0,
                "i_force_change": 42.0,
                "i_input": "",
                "i_sizeref": "",
                "i_uRedOffset": [
                    0.0,
                    0.0
                ],
                "o_enabled": 0.0,
                "o_output": ""
            },
            "type": "ChromaticAberration",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2645.0,
                    206.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 10,
            "manual_values": {
                "i_x": 5.0,
                "i_y": 0.0,
                "o_vec2": [
                    5.0,
                    0.0
                ]
            },
            "type": "Float2Vec2",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2458.0,
                    461.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [
                [
                    "i_time",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "time",
                        "widgets": []
                    }
                ],
                [
                    "i_time_mask",
                    {
                        "default": null,
                        "dtype": "tex2d",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "time_mask",
                        "widgets": []
                    }
                ],
                [
                    "i_time_d0",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 0.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "time_d0",
                        "widgets": []
                    }
                ],
                [
                    "i_time_d1",
                    {
                        "default": null,
                        "dtype": "float",
                        "dtype_args": {
                            "default": 0.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "time_d1",
                        "widgets": []
                    }
                ],
                [
                    "i_mouse",
                    {
                        "default": null,
                        "dtype": "vec2",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": false,
                        "manual_input": true,
                        "name": "mouse",
                        "widgets": []
                    }
                ]
            ],
            "id": 11,
            "manual_values": {
                "i_enable_time_mask": 1.0,
                "i_enabled": 1.0,
                "i_force_change": 42.0,
                "i_fragment_source": "\n#include <generate/base_time_mask.frag>\n// Shader downloaded and adapted from glslsandbox.com\n// URL: http://glslsandbox.com/e#50911.0\n\n/*\n * Original shader from: https://www.shadertoy.com/view/XtyBWt\n */\n\n//#extension GL_OES_standard_derivatives : enable\n\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// glslsandbox uniforms\n\n;\nuniform vec2 mouse;\n\n// shadertoy globals\nfloat iTime = 0.0;\nvec3  iResolution = vec3(0.0);\nvec4  iMouse = vec4(0.0);\n\n// Emulate a black texture\n#define texture(s, uv) vec4(0.0)\n\n// --------[ Original ShaderToy begins here ]---------- //\n#define EPSILON 0.0001\n#define NEARCLIP 0.0001\n#define FARCLIP 100.0\n#define MARCHSTEPS 500\n\n#define ALL 1\n#define CUBEMAP_REFLECTION 1\n#define BLINN_PHONG 1\n#define AO 1\n#define SHADOWS 1\n#define SCENE_REFLECTION 1\n#define SSS 1\n#define VIGNETTE 1\n#define COLOR 1\n\n#define SSS_STEPS 25\n\nstruct Material\n{\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    float shininess;\n    float reflection;\n    float sss;\n};\n\nstruct DirLight\n{\n    vec3 dir;\n    vec3 color;\n};\n\nstruct RayResult\n{\n    float dist;\n    Material material;\n};\n\nconst Material kNoMaterial = Material(\n    vec3(0.0, 0.0, 0.0),\n    vec3(0.0, 0.0, 0.0),\n    vec3(0.0, 0.0, 0.0),\n    0.0,\n    0.0,\n    0.0\n);\n\nconst Material kMaterialRed = Material(\n    vec3(0.2, 0.0, 0.0),\n    vec3(0.9, 0.0, 0.0),\n    vec3(1.0, 0.9, 0.9),\n    512.0,\n    0.0,\n    5.0\n);\n\nconst Material kMaterialGreen = Material(\n    vec3(0.0, 0.1, 0.0),\n    vec3(0.0, 0.9, 0.0),\n    vec3(0.9, 1.0, 0.9),\n    0.0,\n    0.09,\n    4.0\n);\n\nconst Material kMaterialBlue = Material(\n    vec3(0.0, 0.0, 0.1),\n    vec3(0.0, 0.0, 0.9),\n    vec3(0.9, 9.0, 1.0),\n    1024.0,\n    0.3,\n    9.0\n);\n\n\nDirLight kDirLight = DirLight(\n    vec3(0.3, 0.35, 0.1),\n    vec3(1.0)\n);\n\nconst vec3 kAmbientColor = vec3(0.376, 0.0, 0.10);\n\nvec3 hash( vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n\n    return fract(sin(p)*43758.5453123);\n}\n\nRayResult opUnion(in RayResult a, in RayResult b)\n{\n    if (a.dist < b.dist) return a;\n    return b;\n}\n\nRayResult opUnion2(in RayResult a, in RayResult b)\n{\n    if (-a.dist < b.dist) return a;\n    return b;\n}\n\nfloat sdRoundBox( vec3 p, vec3 b, float r )\n{\n  vec3 d = abs(p) - b;\n  return length(max(d,0.0)) - r\n         + min(max(d.x,max(d.y,d.z)),0.0); // remove this line for an only partially signed sdf \n}\n\nfloat sdSphere(in vec3 p, float r)\n{\n    return length(p) - r;\n}\n\nfloat sdBox( vec3 p, vec3 b )\n{\n  vec3 d = abs(p) - b;\n  return length(max(d,0.0))\n         + min(max(d.x,max(d.y,d.z)),0.0); // remove this line for an only partially signed sdf \n}\n\nfloat sdTorus( vec3 p, vec2 t )\n{\n  vec2 q = vec2(length(p.xz)-t.x,p.y);\n  return length(q)-t.y;\n}\n\nfloat sdPlane( vec3 p, vec4 n )\n{\n  // n must be normalized\n  return dot(p,n.xyz) + n.w;\n}\n\nfloat opDisp(vec3 p)\n{\n    return sin(20.0*p.x)*sin(20.0*p.y)*sin(20.0*p.z);\n}\n\nvoid opRotate(inout vec2 v, float r)\n{\n    float c = cos(r);\n    float s = sin(r);\n    float vx = v.x * c - v.y * s;\n    float vy = v.x * s + v.y * c;\n    v.x = vx;\n    v.y = vy;\n}\n\nRayResult mapScene(in vec3 p)\n{   \n    p.y += 0.2;\n    float t= iTime * 0.5;\n    float a = sdSphere(p + vec3(1.5 * cos(t), -0.9, 1.5 * sin(t)), 0.8);\n    a += opDisp(p * 0.3) * 0.19;\n    vec3 bp = p + vec3(1.5 * cos(t + 2.5), -1.02, 1.5 * sin(t + 2.5));\n    opRotate(bp.xz, t* 1.8);\n\n    float b = sdBox(bp, vec3(0.88));\n    b -= opDisp(sin(iTime) * p * 0.2) * 0.3;\n    float c = sdBox(p + vec3(0.0, 0.2, 0.0), vec3(4.0, 0.2, 4.0));\n\n\n    return opUnion(RayResult(c, kMaterialBlue),opUnion(RayResult(a, kMaterialRed), RayResult(b, kMaterialGreen)));\n}\n\nvec3 opNormal(in vec3 p)\n{\n    const vec2 e = vec2(0.0, EPSILON);\n    return normalize(vec3(\n        mapScene(p + e.yxx).dist - mapScene(p - e.yxx).dist,\n        mapScene(p + e.xyx).dist - mapScene(p - e.xyx).dist,\n        mapScene(p + e.xxy).dist - mapScene(p - e.xxy).dist\n    ));\n}\n\nRayResult rayMarch(in vec3 ro, in vec3 rd)\n{\n    float total = NEARCLIP;\n    \n    for (int i = 0; i < MARCHSTEPS; ++i)\n    {\n        RayResult ray = mapScene(ro + rd * total);\n        if (ray.dist < EPSILON)\n        {\n            return RayResult(total, ray.material);\n        }\n        \n        total += ray.dist * 0.5;\n        if (total > FARCLIP)\n        {\n            break;\n        }\n    }\n    \n    return RayResult(FARCLIP, kNoMaterial);\n}\n\nfloat opAO(in vec3 p, in vec3 n)\n{\n    float value = 0.0;\n    float s = 1.0;\n    for (int i = 0; i < 3; ++i)\n    {\n        float stepSize = 0.13;\n        float dist = mapScene(p + n * stepSize).dist;\n        value += (stepSize - dist) * s;\n        s *=0.7;\n    }\n    value = value;\n    return clamp(sqrt((0.9 - value) * sqrt(1.0)), -1.0, 1.0);\n}\n\nfloat opHardShadow(in vec3 p, in vec3 ld)\n{\n    float value = 0.0;\n    float total = 0.0;\n    float s = 1.0;\n    for (int i = 0; i < 75; ++i)\n    {\n        float dist = mapScene(p + ld * total * 1.).dist;\n        value += dist * s;\n        total += dist;\n        s *= 0.5;\n    }\n    value = 1.0 - value;\n    vec3 h = p + ld * total;\n    float occ = max(0.0, dot(h, ld));\n    return clamp(value, 0.0, 1.0);\n}\n\nfloat opSSS(in vec3 ro, in vec3 rd, in vec3 n, float dist, float factor);\n\nvec3 opReflection(float dist, in vec3 p, in vec3 dir, in vec3 n)\n{\n    vec3 color = vec3(0.2);\n    vec3 rd = normalize(reflect(dir, n));\n    float ft = max(0.0, dot(rd, n));\n    RayResult ray = rayMarch(p, rd);\n   \n    if (ray.dist < FARCLIP && ft > 0.0)\n    {\n        Material material = ray.material;\n        vec3 hitPoint = p + rd * ray.dist;\n        vec3 n = opNormal(hitPoint);\n        vec3 nld = normalize(kDirLight.dir);\n        vec3 h = normalize(n + nld);\n        float diffuse = max(0.0, dot(n, nld));\n        float specular = pow(max(0.0, dot(h, n)), material.shininess);\n        vec3 sss = opSSS(hitPoint, nld, n, dist, material.sss) * material.diffuse;\n        \n        if (material.shininess == 0.0) specular = 0.0;\n        \n        vec3 color = (material.ambient) / 2.0;\n        \n        #if defined(BLINN_PHONG) && defined(ALL)\n        color += \n            ((material.diffuse + kDirLight.color) / 2.0) * diffuse +\n            ((material.specular * specular));\n        #endif\n        \n        #if defined(SSS) && defined(ALL)\n        color += sss * clamp(material.sss, 0.0, 1.0);\n        #endif\n            \n        return color;\n    }\n    return kAmbientColor.rgb;\n}\n\nfloat opSSS(in vec3 ro, in vec3 rd, in vec3 n, float dist, float factor)\n{\n    #if 1\n    float value = 0.0;\n    vec3 nrd = refract(rd, n, 1.0);\n    float s = 1.0;\n    #if __VERSION__ == 100\n    const int steps = SSS_STEPS;\n    #else\n    int steps = int(factor);\n    #endif\n    for (int i = 0; i < steps; ++i)\n    {\n        float stepSize = (float(i) / float(steps));\n        float d = mapScene(ro + nrd * stepSize).dist;\n        value += (stepSize - d) * s;\n        s *= 0.6;\n    }\n    value = pow(value, 0.2);\n    value = clamp(abs(1.0 - value), 0.0, 1.0000001);\n    return value;\n    \n    #else\n    float value = 0.0;\n    vec3 nrd = refract(rd, n, 1.0);\n    float s = 1.0;\n    #if __VERSION__ == 100\n    const int steps = SSS_STEPS;\n    #else\n    int steps = int(factor);\n    #endif\n    for (int i = 0; i < steps; ++i)\n    {\n        float stepSize = float(i) / factor;\n        float d = mapScene(ro + nrd * stepSize).dist;\n        value += (stepSize - d) * s;\n        s *=0.75;\n    }\n    value = pow(value, 0.2);\n    value = clamp(1.0 - value, 0.0, 1.0);\n    return value;\n    #endif\n}\n\nfloat opShadow(in vec3 ro, in vec3 rd, in float mint, in float tmax )\n{\n    float res = 1.0;\n    float t = mint;\n    for( int i=0; i<32; i++ )\n    {\n        float h = mapScene( ro + rd * t ).dist;\n        res = min( res, 2.0*h/t );\n        t += clamp( h, 0.02, 0.10 );\n        if( h<0.001 || t>tmax ) break;\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n\nvec3 shade(float dist, in vec3 ro, in vec3 rd, in vec3 hitPoint, in Material material)\n{\n    vec3 n = opNormal(hitPoint);\n    vec3 nld = normalize(kDirLight.dir);\n    vec3 h = normalize(n + nld);\n    float diffuse = max(0.0, dot(n, nld));\n    float specular = pow(max(0.0, dot(h, n)), material.shininess);\n    float ao = opAO(hitPoint, n);\n    float shadow = opShadow(hitPoint, nld, 0.1, 0.9);\n//    float shadow = opHardShadow(hitPoint, nld);\n    vec3 reflectionColor = opReflection(dist, hitPoint, rd, n);\n    vec3 sss = opSSS(hitPoint, nld, n, dist, material.sss) * (material.diffuse * 1.2);\n    vec3 color = n;\n    \n    if (material.shininess == 0.0) specular = 0.0;\n    \n    #if defined(BLINN_PHONG) && defined(ALL)\n    color = (material.ambient + kAmbientColor.rgb) / 2.0 +\n        ((material.diffuse + kDirLight.color) / 2.0) * diffuse +\n        ((material.specular * specular));\n    #endif\n    #if defined(SCENE_REFLECTION) && defined(ALL)\n    color = mix(color, clamp(reflectionColor, vec3(0.0), vec3(1.0)),  clamp(material.reflection, 0.0, 1.0));\n    #endif\n    #if defined(CUBEMAP_REFLECTION) && defined(ALL)\n    color = mix(color, texture(iChannel0, reflect(rd, n)).rgb, material.reflection);\n    #endif\n    #if defined(AO) && defined(ALL)\n    color *= ao;\n    #endif\n    #if defined(SHADOWS) && defined(ALL)\n    color *= shadow * 0.2 + 0.7;\n    #endif\n    #if defined(SSS) && defined(ALL)\n    color += sss * clamp(material.sss, 0.0, 1.0);\n    #endif\n    return color;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    float ar = iResolution.x / iResolution.y;\n    vec3 color = kAmbientColor.rgb;\n    vec2 uv = (fragCoord.xy / iResolution.xy - 0.5) * vec2(ar, 1.0);\n    vec3 ro = vec3(0.0, 4.0, -9.5);\n    vec3 rd = normalize(vec3(uv, 1.0));\n    opRotate(ro.xz, (iMouse.x / iResolution.x * 2.0 - 1.0) * 0.5);\n    opRotate(rd.xz, (iMouse.x / iResolution.x * 2.0 - 1.0) * 0.5);\n    opRotate(rd.yz, 0.4);\n    opRotate(kDirLight.dir.xz, iTime * 1.5);\n    \n    RayResult ray = rayMarch(ro, rd);\n    \n    if (ray.dist < FARCLIP)\n    {\n        vec3 hitPoint = ro  + rd * ray.dist;\n        color = shade(ray.dist, ro, rd, hitPoint, ray.material);\n    }\n\n    #if defined(COLOR)\n    color = pow(color, vec3(1.0/1.6));\n    #endif\n    \n    #if defined(VIGNETTE)\n    color = mix(color, color * 0.2, max(0.0, pow(length(1.0 * uv / vec2(ar, 1.0)), 2.9)));\n    #endif\n    \n    fragColor = vec4(color, 1.0);\n}\n// --------[ Original ShaderToy ends here ]---------- //\n\n\n\nvoid generateFrag() {\n\n\n    iTime = pyvisualTime;\n    iResolution = vec3(pyvisualResolution, 0.0);\n    iMouse = vec4(mouse * pyvisualResolution, 0.0, 0.0);\n\n    mainImage(pyvisualOutColor, (vec2(pyvisualUV.x, 1.0 - pyvisualUV.y) * pyvisualResolution).xy);\n}",
                "i_id": "50911.0",
                "i_input": "",
                "i_interpolation": 1.0,
                "i_mouse": [
                    0.0,
                    0.0
                ],
                "i_sizeref": "",
                "i_time": 0.0,
                "i_time_d0": 0.0,
                "i_time_d1": 2.7300000190734863,
                "i_time_mask": "",
                "i_transformUV": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "i_wrapping": 1.0,
                "o_enabled": 1.0,
                "o_output": ""
            },
            "type": "GLSLSandbox",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2062.0,
                    269.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 12,
            "manual_values": {
                "i_x": 0.07000000029802322,
                "i_y": 0.0,
                "o_vec2": [
                    0.6072158217430115,
                    0.0
                ]
            },
            "type": "Float2Vec2",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1691.0,
                    495.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 13,
            "manual_values": {
                "i_length": 120.0,
                "i_max": 1.0,
                "i_min": 0.0,
                "i_phase": 0.0,
                "i_type": 3.0,
                "o_output": 0.6072158054655581
            },
            "type": "LFO",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1300.0,
                    510.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [
                [
                    "i_filter_mask",
                    {
                        "default": null,
                        "dtype": "tex2d",
                        "dtype_args": {},
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mask",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_mode",
                    {
                        "default": null,
                        "dtype": "int",
                        "dtype_args": {
                            "choices": [
                                "input",
                                "mask",
                                "filtered",
                                "input_filtered_masked",
                                "input_masked",
                                "filtered_masked"
                            ],
                            "default": 2.0
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_mode",
                        "widgets": []
                    }
                ],
                [
                    "i_filter_bg",
                    {
                        "default": null,
                        "dtype": "color",
                        "dtype_args": {
                            "default": [
                                0.0,
                                0.0,
                                0.0,
                                0.0
                            ]
                        },
                        "dummy": false,
                        "group": "default",
                        "hide": true,
                        "manual_input": true,
                        "name": "filter_bg",
                        "widgets": []
                    }
                ]
            ],
            "id": 14,
            "manual_values": {
                "i_advanced_filtering": 0.0,
                "i_enabled": 1.0,
                "i_filter_bg": [
                    0.0,
                    0.0,
                    0.0,
                    0.0
                ],
                "i_filter_mask": "",
                "i_filter_mode": 2.0,
                "i_force_change": 42.0,
                "i_input": "",
                "i_interpolation": 1.0,
                "i_sizeref": "",
                "i_transformUV": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "i_wrapping": 1.0,
                "o_enabled": 1.0,
                "o_output": ""
            },
            "type": "SampleTexture",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1876.0,
                    158.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 15,
            "manual_values": {
                "i_uniform": 1.0,
                "i_x": 7.050000190734863,
                "i_y": 7.050000190734863,
                "o_output": [
                    [
                        7.050000190734863,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        7.050000190734863,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ]
            },
            "type": "Scale",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1623.0,
                    -474.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 16,
            "manual_values": {
                "i_theta": -43.849998474121094,
                "o_output": [
                    [
                        0.935910165309906,
                        0.35223880410194397,
                        0.0,
                        0.0
                    ],
                    [
                        -0.35223880410194397,
                        0.935910165309906,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ]
            },
            "type": "Rotate",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1724.0,
                    -351.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 17,
            "manual_values": {
                "i_t1": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "i_t2": [
                    [
                        1.0,
                        0.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "o_output": [
                    [
                        6.5981669425964355,
                        2.483283519744873,
                        0.0,
                        0.0
                    ],
                    [
                        -2.483283519744873,
                        6.5981669425964355,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        0.0,
                        1.0
                    ]
                ]
            },
            "type": "Dot",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    2035.0,
                    -236.0
                ],
                "selected": false
            }
        },
        {
            "custom_ports": [],
            "id": 18,
            "manual_values": {
                "i_factor": 5.0,
                "i_mod": 0.0,
                "i_reset": 0.0,
                "o_output": 20.624312162399292
            },
            "type": "Time",
            "ui_data": {
                "collapsed": false,
                "pos": [
                    1404.0,
                    -355.0
                ],
                "selected": false
            }
        }
    ],
    "ui_data": {
        "offset": [
            1322.0,
            -349.0
        ]
    }
}